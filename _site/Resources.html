<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Peanut Tutorial - Resources</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Peanut Tutorial</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./ECD.html" rel="" target="">
 <span class="menu-text">ECD Intro</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./BayesNets.html" rel="" target="">
 <span class="menu-text">Bayesian Networks</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Heart.html" rel="" target="">
 <span class="menu-text">Heart Example</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Scoring.html" rel="" target="">
 <span class="menu-text">Scoring</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./DiBelloModels.html" rel="" target="">
 <span class="menu-text">Making CPTs</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Building.html" rel="" target="">
 <span class="menu-text">Building Nets</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Updating.html" rel="" target="">
 <span class="menu-text">Calibration</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Visualization.html" rel="" target="">
 <span class="menu-text">Model checking and visualzation</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Dynamic.html" rel="" target="">
 <span class="menu-text">Dynamic Models</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./Resources.html" rel="" target="" aria-current="page">
 <span class="menu-text">Resources</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./References.html" rel="" target="">
 <span class="menu-text">References</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar"><div class="quarto-margin-header"><div class="margin-header-item">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./img/PeanutLogo.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Peanut Logo</figcaption>
</figure>
</div>
</div></div>
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#these-web-pages" id="toc-these-web-pages" class="nav-link active" data-scroll-target="#these-web-pages">These Web Pages</a></li>
  <li><a href="#netica" id="toc-netica" class="nav-link" data-scroll-target="#netica">Netica</a></li>
  <li><a href="#peanut-and-rnetia" id="toc-peanut-and-rnetia" class="nav-link" data-scroll-target="#peanut-and-rnetia">Peanut and RNetia</a></li>
  <li><a href="#sample-networks." id="toc-sample-networks." class="nav-link" data-scroll-target="#sample-networks.">Sample Networks.</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Resources</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="these-web-pages" class="level2">
<h2 class="anchored" data-anchor-id="these-web-pages">These Web Pages</h2>
<p>These web pages are available in both a static version (<a href="https://pluto.coe.fsu.edu/PeanutTutorial" class="uri">https://pluto.coe.fsu.edu/PeanutTutorial</a>) and a source version (<a href="https://github.com/ralmond/PeanutTutorial" class="uri">https://github.com/ralmond/PeanutTutorial</a>.git).</p>
<p>The easiest way to access the Peanut tutorial is to use <a href="https://posit.co/products/open-source/rstudio/">R Studio</a>. Go to new project, and select “From Version control”, then “Git” then put ‘https://github.com/ralmond/PeanutTutorial.git’ in the ‘Repository URL’ box.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/GitDialog.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Git dialog</figcaption>
</figure>
</div>
<p>The <code>.qmd</code> files contain a mixture of text and R code. You will need to download the <code>quarto</code> package for these to work properly, but R Studio will guide you through this.</p>
</section>
<section id="netica" class="level2">
<h2 class="anchored" data-anchor-id="netica">Netica</h2>
<p>There are a number of packages that will do the basic Bayesian network computations. For the purposes of this tutorial, we are using <a href="https://norsys.com">Netica</a>Ⓡ. Netica is available in two versions: a graphical user interface (GUI) version and an application programmers interface (API). We will use both in this class.</p>
<p>Netica also comes in both a free (but not open source) version and a paid version. The paid version is used by purchasing an unlock code from Norsys. The free version is specifically for training and evaluation. It is limited in the size of the networks, but it has sufficient capacity for most of the exercises in this tutorial.</p>
<ul>
<li>Go to <code>https://norsys.com</code> and download the latest version of <a href="https://norsys.com/downloads/Netica_Win.exe"><code>Netica.exe</code></a>.</li>
<li>Unix/linux users: <code>Netica.exe</code> runs without major problems under Wine64.</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt install wine64</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> https://norsys.com/downloads/Netica_Win.exe <span class="op">&gt;</span> Netica_Win.exe</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="ex">wine64</span> Netica_Win.exe</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="ex">wine64</span> <span class="st">"C:</span><span class="dt">\\</span><span class="st">Netica\Netica 609\Netica.exe"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD - Mac OS Intel – I have built a wineskin version of <code>Netica.exe</code>. It is available at <a href="https://pluto.coe.fsu.edu/MacNetica2.app.zip" class="uri">https://pluto.coe.fsu.edu/MacNetica2.app.zip</a> (You may need to right click on the app, and then open the Wineskin app inside). - Mac OS ARM – I don’t have access to an ARM Mac to do testing. I am seeing reports that the latest version of Wine supports Rosetta. If you are using homebrew, you can try: ======= - There is also a version of <a href="https://www.codeweavers.com/crossover">Cross Over</a> for Linux; this uses the same Wine code base, but provides 1-year technical support. There is also a 30-day free trial.</p>
<ul>
<li><p>Mac OS. A couple of options:</p></li>
<li><p><em>Prebuilt wineskin</em>. I’ve used the <a href="https://github.com/Gcenx/WineskinServer/">wineskin</a> tool to pre-wrap an image. This is available at <a href="https://pluto.coe.fsu.edu/BNinEA/NeticaMac.dmg">NeticaMac.dmg</a>.</p>
<ul>
<li>This is not properly signed, so will generate issues with the apple quarantine system. <del>Open the <code>System Preferences...</code> and go to the <code>Security &amp; Privacy</code> tab. Unlock (requires admin password) and then select “App Store and identified developers”. Click on the “NeticaSilicon.app”, this will give an error message. Go back to the security and privacy tab, and a button asking if you want to run the application should be there. Click it to give it permission to run.</del></li>
<li>Apple’s GateKeeper <strong>really</strong> doesn’t want you to run research software on your computer. I think this works, but it needs to be a user with admin privileges. Copy <code>NeticaSilicon.app</code> to someplace on your computer, I’m assuming you are copying it to <code>/Applications</code>. Then open a terminal and type <code>xattr -c -r /Applications/NeticaSilicon.app</code> (change the location if you installed the file someplace else). This may give a few error messages, but it should now work.</li>
</ul></li>
<li><p><em>Install Wine</em> If you are using <a href="https://brew.sh">homebrew</a>, you can try: &gt;&gt;&gt;&gt;&gt;&gt;&gt; 1b8aba9584e85d6ddafaae1e8ed80053a7dbf65f</p></li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">brew</span> install <span class="at">--cask</span> wine-stable</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> https://norsys.com/downloads/Netica_Win.exe <span class="op">&gt;</span> Netica_Win.exe</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="ex">wine</span> Netica_Win.exe</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="ex">wine</span> <span class="st">"C:</span><span class="dt">\\</span><span class="st">Netica\Netica 609\Netica.exe"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li>Use <a href="https://www.codeweavers.com/crossover">Cross Over</a> (see above).</li>
</ul>
<p>Note, these all install the unlicensed version of Netica. You will still need to purchase a license key from Norsys (https://norsys.com). Note that GUI license key and the API license key needed for RNetica, are separate purchase. (You can buy a combined key but it is twice as expensive).</p>
<p>Brent Borelange (Norsys CEO) has expressed willingness to support Netica run under Wine/Crossover. (I have not had problems.)</p>
</section>
<section id="peanut-and-rnetia" class="level2">
<h2 class="anchored" data-anchor-id="peanut-and-rnetia">Peanut and RNetia</h2>
<p>The R package <code>RNetica</code> provides an R binding of the Netica API (hence, it requires the API and not GUI license). <code>RNetica</code> is available at <a href="https://ralmond.r-universe.dev/" class="uri">https://ralmond.r-universe.dev/</a> (source code is at <a href="https://github.com/ralmond/" class="uri">https://github.com/ralmond/</a>).</p>
<p>If you have not already done so, we recommend downloading <a href="https://posit.co/products/open-source/rstudio/">R Studio</a>, in the process of installing R Studio, you will need to install R itself (&lt;https://cloud.r-project.org/).</p>
<p>Once you have R installed, you can install <code>RNetica</code> and running related packages by running the following code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">'PNetica'</span>)) </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="fu">c</span>(<span class="st">'CPTtootls'</span>,<span class="st">'RNetica'</span>,<span class="st">'Peanut'</span>,<span class="st">'PNetica'</span>),</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">repos =</span> <span class="fu">c</span>(<span class="st">'https://ralmond.r-universe.dev'</span>,    <span class="st">'https://cloud.r-project.org'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: PNetica</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: RNetica</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: CPTtools</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: Peanut</code></pre>
</div>
</div>
<p>This bundle contains the following packages:</p>
<ul>
<li><code>CPTtools</code> — A collection of functions for making conditional probability tables. (Does not depend on Netica.)</li>
<li><code>RNetica</code> — An R binding of the Netica API. Note that the installer downloads and installs Netica, so cognizant of the Netica License.</li>
<li><code>Peanut</code> — An object oriented layer for working with parameterized networks (<code>PNet</code>s).<br>
</li>
<li><code>PNetica</code> — All of the Netica specific implementation of the <code>Peanut</code> protocol.</li>
</ul>
<p>The intention is that <code>Peanut</code> (and <code>CPTtools</code>) are open implementation protocols that are independent of the specific Bayes net implementation. I’m currently looking for volunteers to build the equivalent of <code>PNetica</code> for other Bayes net engines.</p>
<p>If you purchase a license key from Norsys, I recommend putting it into the <code>.Renviron</code> file in your home directory.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#|eval: false</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="va">NETICA_LICENSE_KEY</span><span class="op">=</span><span class="st">"+AlmondR/FloridaStateU/120,310-6-A/XXXXX"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>RNetica</code> package will set the license key from this variable if it is present when it launches.</p>
</section>
<section id="sample-networks." class="level2">
<h2 class="anchored" data-anchor-id="sample-networks.">Sample Networks.</h2>
<p>The following zip files contain the sample networks used in the tutorial. (If you have downloaded the complete tutorial from github, you have already downloaded these and can skip this step.)</p>
<ul>
<li><a href="https://pluto.coe.fsu.edu/PeanutTutorial/IntroNets.zip">IntroNets.zip</a> Used in Session 1</li>
<li><a href="https://pluto.coe.fsu.edu/PeanutTutorial/CompensatoryConjunctiveNets.zip">CompensatoryConjunctiveNets.zip</a> Used in Session 2</li>
<li><a href="https://pluto.coe.fsu.edu/PeanutTutorial/miniACED.zip">miniACED</a> Used in Session 3a</li>
<li><a href="https://pluto.coe.fsu.edu/PeanutTutorial/LearningNets.zip">LearningNets</a> Used in Session ??</li>
<li><a href="https://pluto.coe.fsu.edu/PeanutTutorial/DBNExamples.zip">DBNExamples</a> Used in Session 4</li>
</ul>
<p>Download these and unzip them in the directory from which you will be running R.</p>
<p>(If you put them somewhere else, you may need to adjust scripts to point to the right directory.)</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>