<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Peanut Tutorial - Heart Disease Example</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Peanut Tutorial</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./ECD.html" rel="" target="">
 <span class="menu-text">ECD Intro</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./BayesNets.html" rel="" target="">
 <span class="menu-text">Bayesian Networks</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./Heart.html" rel="" target="" aria-current="page">
 <span class="menu-text">Heart Example</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Scoring.html" rel="" target="">
 <span class="menu-text">Scoring</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./DiBelloModels.html" rel="" target="">
 <span class="menu-text">Making CPTs</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Building.html" rel="" target="">
 <span class="menu-text">Building Nets</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Updating.html" rel="" target="">
 <span class="menu-text">Calibration</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Visualization.html" rel="" target="">
 <span class="menu-text">Model checking and visualzation</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Dynamic.html" rel="" target="">
 <span class="menu-text">Dynamic Models</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Resources.html" rel="" target="">
 <span class="menu-text">Resources</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./References.html" rel="" target="">
 <span class="menu-text">References</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar"><div class="quarto-margin-header"><div class="margin-header-item">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./img/PeanutLogo.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Peanut Logo</figcaption>
</figure>
</div>
</div></div>
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#bayesian-network" id="toc-bayesian-network" class="nav-link active" data-scroll-target="#bayesian-network">Bayesian network</a></li>
  <li><a href="#discrete-and-continuous-nodes" id="toc-discrete-and-continuous-nodes" class="nav-link" data-scroll-target="#discrete-and-continuous-nodes">Discrete and Continuous nodes</a></li>
  <li><a href="#functional-dependencies" id="toc-functional-dependencies" class="nav-link" data-scroll-target="#functional-dependencies">Functional Dependencies</a></li>
  <li><a href="#inferences" id="toc-inferences" class="nav-link" data-scroll-target="#inferences">Inferences</a>
  <ul class="collapse">
  <li><a href="#beliefs" id="toc-beliefs" class="nav-link" data-scroll-target="#beliefs">Beliefs</a></li>
  <li><a href="#first-pass-data" id="toc-first-pass-data" class="nav-link" data-scroll-target="#first-pass-data">First pass data</a></li>
  <li><a href="#blocked-evidence" id="toc-blocked-evidence" class="nav-link" data-scroll-target="#blocked-evidence">Blocked Evidence</a></li>
  <li><a href="#virutal-evidence" id="toc-virutal-evidence" class="nav-link" data-scroll-target="#virutal-evidence">Virutal Evidence</a></li>
  <li><a href="#likelihood" id="toc-likelihood" class="nav-link" data-scroll-target="#likelihood">Likelihood</a></li>
  </ul></li>
  <li><a href="#weight-of-evidence-balance-sheet" id="toc-weight-of-evidence-balance-sheet" class="nav-link" data-scroll-target="#weight-of-evidence-balance-sheet">Weight of Evidence balance sheet</a>
  <ul class="collapse">
  <li><a href="#conditional-weight-of-evidence" id="toc-conditional-weight-of-evidence" class="nav-link" data-scroll-target="#conditional-weight-of-evidence">Conditional Weight of Evidence</a></li>
  <li><a href="#example" id="toc-example" class="nav-link" data-scroll-target="#example">Example</a></li>
  <li><a href="#weight-of-evidence-balance-sheet-1" id="toc-weight-of-evidence-balance-sheet-1" class="nav-link" data-scroll-target="#weight-of-evidence-balance-sheet-1">Weight of Evidence Balance Sheet</a></li>
  <li><a href="#order-sensitivity" id="toc-order-sensitivity" class="nav-link" data-scroll-target="#order-sensitivity">Order sensitivity</a></li>
  </ul></li>
  <li><a href="#test-selection-and-value-of-information" id="toc-test-selection-and-value-of-information" class="nav-link" data-scroll-target="#test-selection-and-value-of-information">Test Selection and Value of Information</a>
  <ul class="collapse">
  <li><a href="#expected-weight-of-evidence" id="toc-expected-weight-of-evidence" class="nav-link" data-scroll-target="#expected-weight-of-evidence">Expected Weight of Evidence</a></li>
  <li><a href="#mutual-information" id="toc-mutual-information" class="nav-link" data-scroll-target="#mutual-information">Mutual Information</a></li>
  <li><a href="#reduction-in-variance" id="toc-reduction-in-variance" class="nav-link" data-scroll-target="#reduction-in-variance">Reduction in Variance</a></li>
  </ul></li>
  <li><a href="#learning-models-from-data" id="toc-learning-models-from-data" class="nav-link" data-scroll-target="#learning-models-from-data">Learning Models from Data</a>
  <ul class="collapse">
  <li><a href="#build-network-structure." id="toc-build-network-structure." class="nav-link" data-scroll-target="#build-network-structure.">Build network structure.</a></li>
  <li><a href="#node-sets" id="toc-node-sets" class="nav-link" data-scroll-target="#node-sets">Node Sets</a></li>
  <li><a href="#building-cpts-from-tables" id="toc-building-cpts-from-tables" class="nav-link" data-scroll-target="#building-cpts-from-tables">Building CPTs from tables</a></li>
  <li><a href="#the-healthy-node" id="toc-the-healthy-node" class="nav-link" data-scroll-target="#the-healthy-node">The Healthy? node</a></li>
  </ul></li>
  <li><a href="#working-with-case-files" id="toc-working-with-case-files" class="nav-link" data-scroll-target="#working-with-case-files">Working with Case Files</a>
  <ul class="collapse">
  <li><a href="#generating-random-cases" id="toc-generating-random-cases" class="nav-link" data-scroll-target="#generating-random-cases">Generating random cases</a></li>
  <li><a href="#converting-data-into-case-file-format" id="toc-converting-data-into-case-file-format" class="nav-link" data-scroll-target="#converting-data-into-case-file-format">Converting data into case file format</a></li>
  <li><a href="#bulk-scoring-and-testing" id="toc-bulk-scoring-and-testing" class="nav-link" data-scroll-target="#bulk-scoring-and-testing">Bulk Scoring and Testing</a></li>
  <li><a href="#learning-cpts" id="toc-learning-cpts" class="nav-link" data-scroll-target="#learning-cpts">Learning CPTs</a></li>
  </ul></li>
  <li><a href="#learning-structure-from-data" id="toc-learning-structure-from-data" class="nav-link" data-scroll-target="#learning-structure-from-data">Learning Structure from Data</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Heart Disease Example</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>This example is based on a study by <span class="citation" data-cites="janosi1989">(<a href="#ref-janosi1989" role="doc-biblioref"><strong>janosi1989?</strong></a>)</span> and recorded in the UCI Machine Learning Repository (<span class="citation" data-cites="Murphy1992">(<a href="#ref-Murphy1992" role="doc-biblioref"><strong>Murphy1992?</strong></a>)</span>). The direct link is: <a href="https://archive.ics.uci.edu/dataset/45/heart+disease" class="uri">https://archive.ics.uci.edu/dataset/45/heart+disease</a></p>
<p><span class="citation" data-cites="testSelection">Madigan &amp; Almond (<a href="#ref-testSelection" role="doc-biblioref">1995</a>)</span> used it as an extended example.</p>
<section id="bayesian-network" class="level2">
<h2 class="anchored" data-anchor-id="bayesian-network">Bayesian network</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(PNetica)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>sess <span class="ot">&lt;-</span> <span class="fu">NeticaSession</span>()</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">startSession</span>(sess)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Netica 6.07 Linux (AFCl64), (C) 1992-2019 Norsys Software Corp.

Netica is operating without a password; there are some limitations.</code></pre>
</div>
</div>
<p>A saved version of the network can be found <code>Heart/Heart.dne</code></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Heart/HeartBase.svg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Heart Disease Model</figcaption>
</figure>
</div>
</section>
<section id="discrete-and-continuous-nodes" class="level2">
<h2 class="anchored" data-anchor-id="discrete-and-continuous-nodes">Discrete and Continuous nodes</h2>
<p>Note that some of the nodes have a number, plus or minus a second number.</p>
<p>This is the Expected value, plus or minus the standard deviation.</p>
<p>This can be done in one of two ways.</p>
<ul>
<li>Add State levels to a discrete node.
<ul>
<li>See <code>Colored-Flor</code> and Health-State` (which represents number of blood vessels with high levels of blockage).</li>
<li>Each state is assigned a number. (Note Netica state names must start with a letter).</li>
</ul></li>
<li>Take a continuous node and cut it into pieces
<ul>
<li>See <code>Age</code>, <code>Rest-BP</code>, <code>Max-Heart-Rate</code>, <code>Chol</code> and <code>Old-Peak</code></li>
<li>The levels define the boundaries between categories.</li>
<li>There is one more boundary than there is categories (like the R function <code>cut</code>).</li>
<li><code>Inf</code> and <code>-Inf</code> are legal cut points.</li>
</ul></li>
</ul>
<p>Note: Netica deals with continuous nodes by discritizing them.</p>
<p>If all nodes in a Bayesian network are discrete, the propagation algorithms involve only sums not integrals.</p>
<p>For graphs with a mixture of continuous and discrete variables, the propagation algorithms may involve integrals that can’t be solved analytically.</p>
</section>
<section id="functional-dependencies" class="level2">
<h2 class="anchored" data-anchor-id="functional-dependencies">Functional Dependencies</h2>
<p>Look at the node <code>Healty?</code></p>
<p>This is a reduction of the <code>Health-State</code> variable, collapsing states <code>S1</code> through <code>S4</code> into the single category <code>No</code>.</p>
<p>The conditional probability table only has <code>0</code> or <code>1</code> as entries.</p>
<p>Can be represented with a table:</p>
<table class="table">
<thead>
<tr class="header">
<th>Health-State</th>
<th>Healthy?</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Healthy</td>
<td>Yes</td>
</tr>
<tr class="even">
<td>S1</td>
<td>No</td>
</tr>
<tr class="odd">
<td>S2</td>
<td>No</td>
</tr>
<tr class="even">
<td>S3</td>
<td>No</td>
</tr>
<tr class="odd">
<td>S4</td>
<td>No</td>
</tr>
</tbody>
</table>
<p>This is really useful for conditioning on <code>Healthy? = No</code>.</p>
</section>
<section id="inferences" class="level2">
<h2 class="anchored" data-anchor-id="inferences">Inferences</h2>
<p>Start by loading the network.</p>
<p>Note, need to pass reference to <code>NeticaSession</code> to <code>ReadNetworks</code>.</p>
<p>Calling <code>NetworkAllNodes</code> builds R objects which point at internal <code>Netica</code> objects.</p>
<p>Need to redo these steps every time R session is restarted.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>heart <span class="ot">&lt;-</span> <span class="fu">ReadNetworks</span>(<span class="st">"Heart/Heart.dne"</span>,sess)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>heart.nodes <span class="ot">&lt;-</span> <span class="fu">NetworkAllNodes</span>(heart)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A <code>NeticaBN</code> or <code>NeticaNode</code> object is <em>active</em> if it points to an object inside of the Netica heap.</p>
<p>Saving/restorting the R object will disconnect it from its corresponding Netica object.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p><code>NeticaSession</code> and <code>NeticaNetwork</code> objects wrap R environments which contain the networks and nodes respectively. So can access with <code>$</code> operator.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>sess<span class="sc">$</span>nets<span class="sc">$</span>Heart</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Netica Network named  Heart 
  Network is currently active.
  Nodes:  Age ca chol CP exang fbs ...
    and  9 others.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>heart<span class="sc">$</span>nodes<span class="sc">$</span>Age</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Continuous Netica Node named  Age in network  Heart 
  Node is currently active.</code></pre>
</div>
</div>
</div>
</div>
</div>
<section id="beliefs" class="level3">
<h3 class="anchored" data-anchor-id="beliefs">Beliefs</h3>
<p>The basic function for querying the network is <code>NodeBelief</code>. This gives the marginal probability of the node.</p>
<p>Note that the network needs to be compiled before doing inference.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">CompileNetwork</span>(heart)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>health <span class="ot">&lt;-</span> <span class="fu">NetworkFindNode</span>(heart,<span class="st">"health"</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>baseline <span class="ot">&lt;-</span> <span class="fu">NodeBeliefs</span>(health)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(baseline,<span class="at">digits=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Healthy      S1      S2      S3      S4 
  0.536   0.182   0.120   0.117   0.045 </code></pre>
</div>
</div>
<p>This is the unconditional probability. To get the <em>conditional</em> probability, we need to add some evidence.</p>
<p>As we have mapped the states to numeric values we can also get the mean and variance.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">NodeExpectedValue</span>(health)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9545453
attr(,"std_dev")
[1] 1.237094</code></pre>
</div>
</div>
</section>
<section id="first-pass-data" class="level3">
<h3 class="anchored" data-anchor-id="first-pass-data">First pass data</h3>
<p>James Goodfellow is a 55 year old man who comes to the doctor complaining of typical anginal pain.</p>
<p>The <code>NodeFinding</code> function is used to set (or get) the value of a node. As <code>Age</code> is a continuous node, its finding can be entered directly with <code>NodeValue</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">NodeFinding</span>(heart<span class="sc">$</span>nodes<span class="sc">$</span>Sex) <span class="ot">&lt;-</span> <span class="st">"Male"</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">NodeFinding</span>(heart<span class="sc">$</span>nodes<span class="sc">$</span>CP) <span class="ot">&lt;-</span> <span class="st">"TypicalAnginal"</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">NodeValue</span>(heart<span class="sc">$</span>nodes<span class="sc">$</span>Age) <span class="ot">&lt;-</span> <span class="dv">55</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">NodeFinding</span>(heart<span class="sc">$</span>nodes<span class="sc">$</span>Age)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  between50and60 
"between50and60" </code></pre>
</div>
</div>
<p>The value of the beliefs for the target mode have now changed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>office <span class="ot">&lt;-</span> <span class="fu">NodeBeliefs</span>(health)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">rbind</span>(<span class="at">baseline=</span>baseline,<span class="at">office=</span>office),<span class="at">digits=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         Healthy   S1   S2    S3    S4
baseline    0.54 0.18 0.12 0.117 0.045
office      0.49 0.29 0.11 0.039 0.061</code></pre>
</div>
</div>
</section>
<section id="blocked-evidence" class="level3">
<h3 class="anchored" data-anchor-id="blocked-evidence">Blocked Evidence</h3>
<p>Assume that the nurse takes Mr.&nbsp;Goodfellows resting blood pressure and it is 130.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">NodeValue</span>(heart<span class="sc">$</span>nodes<span class="sc">$</span>trestbps) <span class="ot">&lt;-</span> <span class="dv">130</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>bp <span class="ot">&lt;-</span> <span class="fu">NodeBeliefs</span>(health)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">rbind</span>(<span class="at">baseline=</span>baseline,<span class="at">office=</span>office,<span class="at">bp=</span>bp),<span class="at">digits=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         Healthy   S1   S2    S3    S4
baseline    0.54 0.18 0.12 0.117 0.045
office      0.49 0.29 0.11 0.039 0.061
bp          0.49 0.29 0.11 0.039 0.061</code></pre>
</div>
</div>
<p>Why didn’t it change?</p>
<p>Look closely at the graph. The path between <code>Rest-BP</code> and <code>Health-State</code> goes through <code>Age</code> which is known. Therefore, the resting blood pressure provides no additional information.</p>
<p>The function <code>RetractNodeFinding</code> clears it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">RetractNodeFinding</span>(heart<span class="sc">$</span>nodes<span class="sc">$</span>trestbps)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="virutal-evidence" class="level3">
<h3 class="anchored" data-anchor-id="virutal-evidence">Virutal Evidence</h3>
<p>Suppose that the doctor is not able to classify the Mr.&nbsp;Goodfellow’s complaint other than to say it is not Asymptomatic. The <code>EnterNegativeFindings</code> function allows eliminating one of the findings.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">RetractNodeFinding</span>(heart<span class="sc">$</span>nodes<span class="sc">$</span>CP)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>before <span class="ot">&lt;-</span> <span class="fu">NodeBeliefs</span>(heart<span class="sc">$</span>nodes<span class="sc">$</span>CP)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">EnterNegativeFinding</span>(heart<span class="sc">$</span>nodes<span class="sc">$</span>CP,<span class="st">"Asymptomatic"</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>after <span class="ot">&lt;-</span> <span class="fu">NodeBeliefs</span>(heart<span class="sc">$</span>nodes<span class="sc">$</span>CP)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">cbind</span>(<span class="at">before=</span>before, <span class="at">after=</span>after),<span class="at">digits=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                before after
TypicalAnginal  0.0827 0.171
AtypicalAnginal 0.1509 0.311
NonAnginal      0.2511 0.518
Asymptomatic    0.5153 0.000</code></pre>
</div>
</div>
<p>The probability is now spread out over the other categories.</p>
<p>Can eliminate more than one categories.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">RetractNodeFinding</span>(heart<span class="sc">$</span>nodes<span class="sc">$</span>CP)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>before <span class="ot">&lt;-</span> <span class="fu">NodeBeliefs</span>(heart<span class="sc">$</span>nodes<span class="sc">$</span>CP)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">EnterNegativeFinding</span>(heart<span class="sc">$</span>nodes<span class="sc">$</span>CP,<span class="fu">c</span>(<span class="st">"Asymptomatic"</span>,<span class="st">"NonAnginal"</span>))</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>after <span class="ot">&lt;-</span> <span class="fu">NodeBeliefs</span>(heart<span class="sc">$</span>nodes<span class="sc">$</span>CP)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">cbind</span>(<span class="at">before=</span>before, <span class="at">after=</span>after),<span class="at">digits=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                before after
TypicalAnginal  0.0827 0.354
AtypicalAnginal 0.1509 0.646
NonAnginal      0.2511 0.000
Asymptomatic    0.5153 0.000</code></pre>
</div>
</div>
<p>Finally, if the evidence from a sensor is uncertain, a likelihood can be entered.</p>
<p>Suppose that the technician doing the thalium stress test is uncertain about the result. They are pretty sure (80%) there is a defect, but they are uncertain as to whether it is fixed or reversible.</p>
<p>This can be expressed as a likelihood: <code>c(.2,.4,.4)</code> and can be set using <code>NodeLikelihood</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">NodeFinding</span>(heart<span class="sc">$</span>nodes<span class="sc">$</span>CP) <span class="ot">&lt;-</span> <span class="st">"TypicalAnginal"</span>  <span class="do">## Return to previous state.</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">NodeLikelihood</span>(heart<span class="sc">$</span>nodes<span class="sc">$</span>thal) <span class="ot">&lt;-</span> <span class="fu">c</span>(.<span class="dv">2</span>,.<span class="dv">4</span>,.<span class="dv">4</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>thalTest <span class="ot">&lt;-</span> <span class="fu">NodeBeliefs</span>(health)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">rbind</span>(<span class="at">baseline=</span>baseline,<span class="at">office=</span>office,<span class="at">thaliumStressTest=</span>thalTest),<span class="at">digits=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  Healthy    S1    S2     S3     S4
baseline            0.536 0.182 0.120 0.1169 0.0455
office              0.494 0.291 0.114 0.0393 0.0610
thaliumStressTest   0.419 0.322 0.137 0.0476 0.0738</code></pre>
</div>
</div>
</section>
<section id="likelihood" class="level3">
<h3 class="anchored" data-anchor-id="likelihood">Likelihood</h3>
<p>The first pass of the propagation algorithm calculates the probability of all of the observed (including vitrual observations) findings, that is the <em>likelihood</em> of the observations.</p>
<p>The function <code>FindingsProbablity</code> extracts this.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">FindingsProbability</span>(heart)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.007482985</code></pre>
</div>
</div>
<p>For contrast, lets retract the findings and move back to the baseline.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">RetractNetFindings</span>(heart)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">FindingsProbability</span>(heart)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
</section>
</section>
<section id="weight-of-evidence-balance-sheet" class="level2">
<h2 class="anchored" data-anchor-id="weight-of-evidence-balance-sheet">Weight of Evidence balance sheet</h2>
<p>How much does each observation contribute to the conclusion that James Goodfellow is healthy.</p>
<p>One measure is the weight of evidence (WOE; <span class="citation" data-cites="good1950">Good (<a href="#ref-good1950" role="doc-biblioref">1950</a>)</span>).</p>
<p><span class="math display">\[
WOE(H:E) = \log \frac{P(H|E)}{P(\neg H|E)} - \log \frac{P(H)}{P(\neg H)} =
\log \frac{P(E|H)}{P(E|\neg H)}
\]</span></p>
<p>Note that this can be calculated by simply differencing the probability of the target node before and after.</p>
<section id="conditional-weight-of-evidence" class="level3">
<h3 class="anchored" data-anchor-id="conditional-weight-of-evidence">Conditional Weight of Evidence</h3>
<p>As the value of the other nodes changes, the WOE will as well.</p>
<p>The conditional weight of evidence is defined by:</p>
<p><span class="math display">\[
WOE(H:E_1|E_2) = \log \frac{P(H|E_1,E_2)}{P(\neg H|E_1,E_2)} - \log \frac{P(H|E_1)}{P(\neg H|E_1)} =
\log \frac{P(E_2|H,E_1)}{P(E_2|\neg H,E_1)}
\]</span></p>
<p>Note that these add:</p>
<p><span class="math display">\[ WOE(H: E_1, E_2) = WOE(H: E_1) + WOE(H: E_2|E_1) \]</span></p>
<p>We can use this to evaluate evidence as it come in</p>
</section>
<section id="example" class="level3">
<h3 class="anchored" data-anchor-id="example">Example</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>jgoodfellow <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Sex=</span><span class="st">"Male"</span>,</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Age=</span><span class="dv">55</span>,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">CP=</span><span class="st">"TypicalAnginal"</span>,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">trestbps=</span><span class="dv">130</span>,</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">chol=</span><span class="dv">255</span>,</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">fbs=</span><span class="st">"high"</span>,</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">exang=</span><span class="st">"No"</span>,</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">restecg=</span><span class="st">"Normal"</span>)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Build up a history</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">RetractNetFindings</span>(heart)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>healthy <span class="ot">&lt;-</span> <span class="fu">NetworkFindNode</span>(heart,<span class="st">"healthy"</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>baseline <span class="ot">&lt;-</span> <span class="fu">NodeBeliefs</span>(healthy)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>hist <span class="ot">&lt;-</span> <span class="fu">matrix</span>(baseline,<span class="at">nrow=</span><span class="dv">1</span>,<span class="at">dimnames=</span><span class="fu">list</span>(<span class="fu">c</span>(<span class="st">"*baseline*"</span>),<span class="fu">names</span>(baseline)))</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(jgoodfellow)) {</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  nodename <span class="ot">&lt;-</span> <span class="fu">names</span>(jgoodfellow)[i]</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  nodeval <span class="ot">&lt;-</span> jgoodfellow[[i]]</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  node <span class="ot">&lt;-</span> <span class="fu">NetworkFindNode</span>(heart,nodename)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.numeric</span>(nodeval)) {</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">NodeValue</span>(node) <span class="ot">&lt;-</span> nodeval</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">NodeFinding</span>(node) <span class="ot">&lt;-</span> nodeval</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>  event <span class="ot">&lt;-</span> <span class="fu">paste</span>(nodename,nodeval,<span class="at">sep=</span><span class="st">"="</span>)</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>  probs <span class="ot">&lt;-</span> <span class="fu">NodeBeliefs</span>(healthy)</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>  hist <span class="ot">&lt;-</span> <span class="fu">rbind</span>(hist,probs)</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>(hist)[i<span class="sc">+</span><span class="dv">1</span>] <span class="ot">&lt;-</span> event</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>hist</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                        Yes        No
*baseline*        0.5357143 0.4642856
Sex=Male          0.4700126 0.5299874
Age=55            0.4041534 0.5958466
CP=TypicalAnginal 0.4942228 0.5057772
trestbps=130      0.4942228 0.5057772
chol=255          0.4056582 0.5943418
fbs=high          0.3879469 0.6120530
exang=No          0.3879469 0.6120530
restecg=Normal    0.5714988 0.4285012</code></pre>
</div>
</div>
<p>The function <code>woe</code> calculates the joint WOE of all of the nodes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">woe</span>(heart.nodes[<span class="fu">names</span>(jgoodfellow)],healthy,<span class="st">"Yes"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6.291509</code></pre>
</div>
</div>
<p>The function <code>CPTtools::woeHist</code> provides a history of the changes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>jgoodHist <span class="ot">&lt;-</span> <span class="fu">woeHist</span>(hist,<span class="st">"Yes"</span>,<span class="st">"No"</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(jgoodHist,<span class="at">digits=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         Sex=Male            Age=55 CP=TypicalAnginal      trestbps=130 
            -11.4             -11.6              15.9               0.0 
         chol=255          fbs=high          exang=No    restecg=Normal 
            -15.6              -3.2               0.0              32.3 </code></pre>
</div>
</div>
</section>
<section id="weight-of-evidence-balance-sheet-1" class="level3">
<h3 class="anchored" data-anchor-id="weight-of-evidence-balance-sheet-1">Weight of Evidence Balance Sheet</h3>
<p><span class="citation" data-cites="madigan1997">(<a href="#ref-madigan1997" role="doc-biblioref"><strong>madigan1997?</strong></a>)</span> provides a nice graphical summary. The function <code>CPTtools::woeBal</code> generates this.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">woeBal</span>(hist,<span class="st">"Yes"</span>,<span class="st">"No"</span>,<span class="at">title=</span><span class="st">"Health status of James Goodfellow"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Heart_files/figure-html/woeBal-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="order-sensitivity" class="level3">
<h3 class="anchored" data-anchor-id="order-sensitivity">Order sensitivity</h3>
<ul>
<li><p>The total weight of evidence does not change with the order in which it is entered.</p></li>
<li><p>The incremental weight of evidence is order sensitive.</p></li>
</ul>
<p>To illustrate this, enter the blood pressure before entering the sex.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">RetractNetFindings</span>(heart)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>healthy <span class="ot">&lt;-</span> <span class="fu">NetworkFindNode</span>(heart,<span class="st">"healthy"</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>baseline <span class="ot">&lt;-</span> <span class="fu">NodeBeliefs</span>(healthy)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>hist1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(baseline,<span class="at">nrow=</span><span class="dv">1</span>,<span class="at">dimnames=</span><span class="fu">list</span>(<span class="fu">c</span>(<span class="st">"*baseline*"</span>),<span class="fu">names</span>(baseline)))</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,<span class="dv">5</span><span class="sc">:</span><span class="fu">length</span>(jgoodfellow))) {</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  nodename <span class="ot">&lt;-</span> <span class="fu">names</span>(jgoodfellow)[i]</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  nodeval <span class="ot">&lt;-</span> jgoodfellow[[i]]</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  node <span class="ot">&lt;-</span> <span class="fu">NetworkFindNode</span>(heart,nodename)</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.numeric</span>(nodeval)) {</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">NodeValue</span>(node) <span class="ot">&lt;-</span> nodeval</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">NodeFinding</span>(node) <span class="ot">&lt;-</span> nodeval</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>  event <span class="ot">&lt;-</span> <span class="fu">paste</span>(nodename,nodeval,<span class="at">sep=</span><span class="st">"="</span>)</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>  probs <span class="ot">&lt;-</span> <span class="fu">NodeBeliefs</span>(healthy)</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>  hist1 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(hist1,probs)</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>(hist1)[<span class="fu">nrow</span>(hist1)] <span class="ot">&lt;-</span> event</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>jgoodHist1 <span class="ot">&lt;-</span> <span class="fu">woeHist</span>(hist1,<span class="st">"Yes"</span>,<span class="st">"No"</span>)</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">cbind</span>(<span class="at">order0=</span>jgoodHist,<span class="at">order1=</span>jgoodHist1),<span class="at">digits=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  order0   order1
Sex=Male          -11.43   0.0178
Age=55            -11.64 -11.4047
CP=TypicalAnginal  15.86 -11.6867
trestbps=130        0.00  15.8552
chol=255          -15.58 -15.5840
fbs=high           -3.21  -3.2141
exang=No            0.00   0.0000
restecg=Normal     32.31  32.3080</code></pre>
</div>
</div>
</section>
</section>
<section id="test-selection-and-value-of-information" class="level2">
<h2 class="anchored" data-anchor-id="test-selection-and-value-of-information">Test Selection and Value of Information</h2>
<p>Suppose the cardiologist is interested in determining the health status of Mr.&nbsp;Goodfellow. There are a number of information measures that can be used to evaluate the tests (corresponding to nodes in the network).</p>
<section id="expected-weight-of-evidence" class="level3">
<h3 class="anchored" data-anchor-id="expected-weight-of-evidence">Expected Weight of Evidence</h3>
<p><span class="citation" data-cites="goodCard1971">Good &amp; Card (<a href="#ref-goodCard1971" role="doc-biblioref">1971</a>)</span> propose using the <em>expected weight of evidence</em> as a measure of potential information.</p>
<p><span class="math display">\[
EWOE (H: E) = \sum_{e \in E} W(H:e) P(e|H).
\]</span></p>
<p>Note this is the expectation wrt the conditional distribution given the hypothesis (using the marginal distribution will have expectation).</p>
<p><span class="citation" data-cites="testSelection">Madigan &amp; Almond (<a href="#ref-testSelection" role="doc-biblioref">1995</a>)</span> offers a simple algorithm for calculating the EWOE for a number of nodes at once.</p>
<ol type="1">
<li>Enter any known findings into the network.</li>
<li>Enter a finding (or virtual evidence) that the Hypothesis is true.</li>
</ol>
<ul>
<li>Calculate <span class="math inline">\(P(E_i|H)\)</span> for all <span class="math inline">\(E_i\)</span> (just reading <code>NodeBeliefs(</code><span class="math inline">\(E_i\)</span><code>)</code>)</li>
</ul>
<ol start="3" type="1">
<li>Replace this with a finding that the hypothesis is false</li>
</ol>
<ul>
<li>Calculate <span class="math inline">\(P(E_i|\neg H)\)</span> for all <span class="math inline">\(E_i\)</span></li>
</ul>
<ol start="4" type="1">
<li>Rectract the hypothesis finding</li>
<li>Calcualte EWOE for all <span class="math inline">\(E_i\)</span></li>
</ol>
<p>The function <code>ewoe</code> does this for us.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>enodes <span class="ot">&lt;-</span> heart.nodes[<span class="fu">c</span>(<span class="st">"thal"</span>, <span class="st">"ca"</span>, <span class="st">"thalach"</span>, <span class="st">"slope"</span>, <span class="st">"oldpeak"</span>)]</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">ewoe</span>(enodes,healthy,<span class="st">"Yes"</span>),<span class="at">digits=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   thal      ca thalach   slope oldpeak 
  25.87   21.14    0.62   12.87   11.07 </code></pre>
</div>
</div>
</section>
<section id="mutual-information" class="level3">
<h3 class="anchored" data-anchor-id="mutual-information">Mutual Information</h3>
<p>EWOE only works with binary hypotheses. A similar measure which works with all states is the <em>mutual information</em>.</p>
<p><span class="math display">\[MI(X,Y) = \sum_{x,y} Pr(x,y) \log \frac{\Pr(x,y)}{Pr(x)Pr(y)}\]</span> To use it as test selection metric, we select a target node, and then calculate the mutual information with all of the potential evidence nodes.</p>
<p>In the Netica GUI, you can do this by selecting the target node, and then the menu item `Network &gt; Sensitivity to Findings …”</p>
<p>In the API, we call the <code>MutualInfo</code> function for each target.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">MutualInfo</span>(health,enodes),<span class="at">digits=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   thal      ca thalach   slope oldpeak 
 0.2056  0.2039  0.0101  0.1151  0.1181 </code></pre>
</div>
</div>
</section>
<section id="reduction-in-variance" class="level3">
<h3 class="anchored" data-anchor-id="reduction-in-variance">Reduction in Variance</h3>
<p>As the target node has numeric values, another meaningful measure is the reduction in variance. This is also reported in the Netica report, or can be calculated with the <code>VarianceOfReal</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">VarianceOfReal</span>(health,enodes))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      thal         ca    thalach      slope    oldpeak 
0.24554364 0.27209573 0.01638281 0.15160286 0.17215686 </code></pre>
</div>
</div>
</section>
</section>
<section id="learning-models-from-data" class="level2">
<h2 class="anchored" data-anchor-id="learning-models-from-data">Learning Models from Data</h2>
<p>Basic idea. Sufficient statistic for conditional probability table is contingency table with parent and child variable. We can calculate this from a data set.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching packages ─────────────────────────────────────── tidyverse 1.3.1 ──</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ ggplot2 3.3.5     ✔ purrr   1.0.1
✔ tibble  3.1.6     ✔ dplyr   1.0.8
✔ tidyr   1.2.0     ✔ stringr 1.4.0
✔ readr   2.1.2     ✔ forcats 0.5.1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()</code></pre>
</div>
</div>
<p>Read in the Cleveland data set from <span class="citation" data-cites="janosi1989">(<a href="#ref-janosi1989" role="doc-biblioref"><strong>janosi1989?</strong></a>)</span>. The <code>heart.features</code> is information about the coding from the web site.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>heart.features <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Age=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="at">below50=</span><span class="dv">50</span>,<span class="at">between50and60=</span><span class="dv">60</span>,<span class="at">above60=</span><span class="dv">100</span>),</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Sex=</span><span class="fu">c</span>(<span class="at">Male=</span><span class="dv">1</span>,<span class="at">Female=</span><span class="dv">0</span>),</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">CP=</span><span class="fu">c</span>(<span class="at">TypicalAnginal=</span><span class="dv">1</span>, <span class="at">AtypicalAnginal=</span><span class="dv">2</span>, <span class="at">NonAnginal=</span><span class="dv">3</span>, <span class="at">Asymptomatic=</span><span class="dv">4</span>),</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">trestbps=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="at">low=</span><span class="dv">120</span>,<span class="at">moderate=</span><span class="dv">140</span>,<span class="at">high=</span><span class="dv">300</span>),</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">chol=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="at">Normal=</span><span class="dv">200</span>, <span class="at">Moderate=</span><span class="dv">250</span>, <span class="at">High=</span><span class="dv">300</span>, <span class="at">VeryHigh=</span><span class="dv">750</span>),</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">fbs=</span><span class="fu">c</span>(<span class="at">high=</span><span class="dv">1</span>,<span class="at">normal=</span><span class="dv">0</span>),</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">restecg=</span><span class="fu">c</span>(<span class="at">Normal=</span><span class="dv">0</span>, <span class="at">STTabnormality=</span><span class="dv">0</span>, <span class="at">LeftVentricularHypertrophy=</span><span class="dv">2</span>),</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">thalach=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="at">Low=</span><span class="dv">130</span>,<span class="at">Moderate=</span><span class="dv">160</span>,<span class="at">High=</span><span class="dv">500</span>),</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">exang=</span><span class="fu">c</span>(<span class="at">Yes=</span><span class="dv">1</span>, <span class="at">No=</span><span class="dv">0</span>),</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">oldpeak=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>,<span class="at">Zero=</span><span class="dv">1</span>,<span class="at">Low=</span><span class="dv">2</span>,<span class="at">High=</span><span class="dv">10</span>),</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">slope=</span><span class="fu">c</span>(<span class="at">down=</span><span class="dv">1</span>, <span class="at">flat=</span><span class="dv">2</span>, <span class="at">up=</span><span class="dv">3</span>),</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">ca=</span><span class="fu">c</span>(<span class="at">Zero=</span><span class="dv">0</span>, <span class="at">One=</span><span class="dv">1</span>, <span class="at">Two=</span><span class="dv">2</span>, <span class="at">Three=</span><span class="dv">3</span>, <span class="at">Four=</span><span class="dv">4</span>),</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">thal=</span><span class="fu">c</span>(<span class="at">Normal=</span><span class="dv">3</span>, <span class="at">FixedDefect=</span><span class="dv">6</span>, <span class="at">ReversibleDefect=</span><span class="dv">7</span>),</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">health=</span><span class="fu">c</span>(<span class="at">Healthy=</span><span class="dv">0</span>, <span class="at">S1=</span><span class="dv">1</span>, <span class="at">S2=</span><span class="dv">2</span>, <span class="at">S3=</span><span class="dv">3</span>, <span class="at">S4=</span><span class="dv">4</span>)</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>heart.cont <span class="ot">&lt;-</span> <span class="fu">sapply</span>(heart.features,<span class="cf">function</span>(states) <span class="fu">length</span>(<span class="fu">names</span>(states)[<span class="dv">1</span>])<span class="sc">==</span>0L)</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>cleveland <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Heart/processed.cleveland.csv"</span>,</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>                      <span class="at">col_names=</span><span class="fu">names</span>(heart.features),</span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>                      <span class="at">col_types=</span><span class="fu">str_pad</span>(<span class="st">""</span>,</span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">width=</span><span class="fu">length</span>(heart.features),</span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">pad=</span><span class="st">"n"</span>),</span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>                      <span class="at">na=</span><span class="st">"?"</span>)</span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (var <span class="cf">in</span> <span class="fu">names</span>(heart.features)) {</span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a>  states <span class="ot">&lt;-</span> heart.features[[var]]</span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">names</span>(states)[<span class="dv">1</span>]<span class="sc">==</span><span class="st">""</span>) {</span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Continuous node, use cut to create variable.</span></span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a>    cleveland[[var]] <span class="ot">&lt;-</span> <span class="fu">cut</span>(cleveland[[var]],<span class="fu">as.numeric</span>(states),</span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true" tabindex="-1"></a>                            <span class="at">labels=</span><span class="fu">names</span>(states)[<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb49-32"><a href="#cb49-32" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb49-33"><a href="#cb49-33" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Discrete node, use factor.</span></span>
<span id="cb49-34"><a href="#cb49-34" aria-hidden="true" tabindex="-1"></a>    cleveland[[var]] <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">as.integer</span>(cleveland[[var]]),</span>
<span id="cb49-35"><a href="#cb49-35" aria-hidden="true" tabindex="-1"></a>                               <span class="at">levels=</span><span class="fu">as.integer</span>(states),<span class="at">labels=</span><span class="fu">names</span>(states))</span>
<span id="cb49-36"><a href="#cb49-36" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb49-37"><a href="#cb49-37" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb49-38"><a href="#cb49-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-39"><a href="#cb49-39" aria-hidden="true" tabindex="-1"></a>cleveland</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 303 × 14
   Age      Sex   CP    trestbps chol  fbs   restecg thalach exang oldpeak slope
   &lt;fct&gt;    &lt;fct&gt; &lt;fct&gt; &lt;fct&gt;    &lt;fct&gt; &lt;fct&gt; &lt;fct&gt;   &lt;fct&gt;   &lt;fct&gt; &lt;fct&gt;   &lt;fct&gt;
 1 above60  Male  Typi… high     Mode… high  LeftVe… Modera… No    High    up   
 2 above60  Male  Asym… high     High  norm… LeftVe… Low     Yes   Low     flat 
 3 above60  Male  Asym… low      Mode… norm… LeftVe… Low     Yes   High    flat 
 4 below50  Male  NonA… moderate Mode… norm… Normal  High    No    High    up   
 5 below50  Fema… Atyp… moderate Mode… norm… LeftVe… High    No    Low     down 
 6 between… Male  Atyp… low      Mode… norm… Normal  High    No    Zero    down 
 7 above60  Fema… Asym… moderate High  norm… LeftVe… Modera… No    High    up   
 8 between… Fema… Asym… low      Very… norm… Normal  High    Yes   Zero    down 
 9 above60  Male  Asym… moderate High  norm… LeftVe… Modera… No    Low     flat 
10 between… Male  Asym… moderate Mode… high  LeftVe… Modera… Yes   High    up   
# … with 293 more rows, and 3 more variables: ca &lt;fct&gt;, thal &lt;fct&gt;,
#   health &lt;fct&gt;</code></pre>
</div>
</div>
<section id="build-network-structure." class="level3">
<h3 class="anchored" data-anchor-id="build-network-structure.">Build network structure.</h3>
<p>For this example, I’ve saved out the network structure, both the node positions and the parents of each node. Read this in:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>heart.structure <span class="ot">&lt;-</span> <span class="fu">dget</span>(<span class="st">"Heart/heartinfo.R"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Make a new network</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>heart1 <span class="ot">&lt;-</span> <span class="fu">GetNamedNetworks</span>(<span class="st">"Heart1"</span>,sess)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(heart1)) <span class="fu">DeleteNetwork</span>(heart1)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>heart1 <span class="ot">&lt;-</span> <span class="fu">CreateNetwork</span>(<span class="st">"Heart1"</span>,sess)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="fu">NetworkTitle</span>(heart1) <span class="ot">&lt;-</span> <span class="st">"Heart example built from Cleveland data."</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ( nodename <span class="cf">in</span> <span class="fu">names</span>(heart.features)) {</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  states <span class="ot">&lt;-</span> heart.features[[nodename]]</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">all</span>(<span class="fu">names</span>(states)<span class="sc">!=</span><span class="st">""</span>)) {</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Discrete Node</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>    newnode <span class="ot">&lt;-</span> <span class="fu">NewDiscreteNode</span>(heart1,nodename,<span class="fu">names</span>(states))</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">NodeLevels</span>(newnode) <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(states)</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>    newnode <span class="ot">&lt;-</span> <span class="fu">NewContinuousNode</span>(heart1,nodename)</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">NodeLevels</span>(newnode) <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(states)</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">NodeStates</span>(newnode) <span class="ot">&lt;-</span> <span class="fu">names</span>(states)[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Fix properties</span></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">NodeTitle</span>(newnode) <span class="ot">&lt;-</span> heart.structure[[nodename]]<span class="sc">$</span>title</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">NodeVisPos</span>(newnode) <span class="ot">&lt;-</span> heart.structure[[nodename]]<span class="sc">$</span>pos</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>}  </span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>heart1.nodes <span class="ot">&lt;-</span> <span class="fu">NetworkAllNodes</span>(heart1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The easiest way of inputting the structure is to look at the list of parents for all nodes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (nodename <span class="cf">in</span> <span class="fu">names</span>(heart.structure)) {</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  parnames <span class="ot">&lt;-</span> heart.structure[[nodename]]<span class="sc">$</span>parents</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(parnames)<span class="sc">==</span>0L) <span class="cf">next</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  node <span class="ot">&lt;-</span> heart1.nodes[[nodename]]</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(node)) <span class="cf">next</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>  parents <span class="ot">&lt;-</span> heart1.nodes[parnames]</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">NodeParents</span>(node) <span class="ot">&lt;-</span> parents</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="node-sets" class="level3">
<h3 class="anchored" data-anchor-id="node-sets">Node Sets</h3>
<p>Node sets allow variables to be tagged according to how they are used.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">NodeSets</span>(heart1<span class="sc">$</span>nodes<span class="sc">$</span>health) <span class="ot">&lt;-</span> <span class="st">"Target"</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">NetworkNodesInSet</span>(heart1,<span class="st">"office"</span>) <span class="ot">&lt;-</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  heart1.nodes[<span class="fu">c</span>(<span class="st">"Age"</span>,<span class="st">"Sex"</span>,<span class="st">"CP"</span>,<span class="st">"trestbps"</span>,<span class="st">"chol"</span>,<span class="st">"fbs"</span>)]</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="fu">NetworkNodesInSet</span>(heart1,<span class="st">"lab"</span>) <span class="ot">&lt;-</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  heart1.nodes[<span class="fu">c</span>(<span class="st">"restecg"</span>, <span class="st">"thalach"</span>, <span class="st">"exang"</span>, <span class="st">"oldpeak"</span>, <span class="st">"slope"</span>, <span class="st">"ca"</span>, <span class="st">"thal"</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="building-cpts-from-tables" class="level3">
<h3 class="anchored" data-anchor-id="building-cpts-from-tables">Building CPTs from tables</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>Age <span class="ot">&lt;-</span> heart1.nodes[[<span class="st">"Age"</span>]]</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>parnames <span class="ot">&lt;-</span> <span class="fu">ParentNames</span>(Age)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>AgeTab <span class="ot">&lt;-</span> <span class="fu">table</span>(cleveland[<span class="fu">c</span>(parnames,<span class="st">"Age"</span>)])</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>AgeTab</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>, , Age = below50

          health
thalach    Healthy S1 S2 S3 S4
  Low            1  3  2  3  1
  Moderate      16  7  3  4  0
  High          48  4  0  1  1

, , Age = between50and60

          health
thalach    Healthy S1 S2 S3 S4
  Low            7  7  3 11  1
  Moderate      26 12 12  4  3
  High          31  8  2  2  1

, , Age = above60

          health
thalach    Healthy S1 S2 S3 S4
  Low            8  3  6  4  3
  Moderate      22  8  7  4  2
  High           5  3  1  2  1</code></pre>
</div>
</div>
<p>There are basically two representations for CPTs, arrays <code>CPTtools::CPA</code> and data frames, <code>CPTtools::CPF</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.CPF</span>(AgeTab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    thalach  health Age.below50 Age.between50and60 Age.above60
1       Low Healthy           1                  7           8
2  Moderate Healthy          16                 26          22
3      High Healthy          48                 31           5
4       Low      S1           3                  7           3
5  Moderate      S1           7                 12           8
6      High      S1           4                  8           3
7       Low      S2           2                  3           6
8  Moderate      S2           3                 12           7
9      High      S2           0                  2           1
10      Low      S3           3                 11           4
11 Moderate      S3           4                  4           4
12     High      S3           1                  2           2
13      Low      S4           1                  1           3
14 Moderate      S4           0                  3           2
15     High      S4           1                  1           1</code></pre>
</div>
</div>
<p>Add 1/(Number of states) to get rid of zeros and then normalize</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">normalize</span>(<span class="fu">as.CPF</span>(AgeTab<span class="sc">+</span><span class="dv">1</span><span class="sc">/</span><span class="fu">NodeNumStates</span>(Age)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    thalach  health Age.below50 Age.between50and60 Age.above60
1       Low Healthy  0.07843137          0.4313725   0.4901961
2  Moderate Healthy  0.25128205          0.4051282   0.3435897
3      High Healthy  0.56862745          0.3686275   0.0627451
4       Low      S1  0.23809524          0.5238095   0.2380952
5  Moderate      S1  0.26190476          0.4404762   0.2976190
6      High      S1  0.27083333          0.5208333   0.2083333
7       Low      S2  0.19444444          0.2777778   0.5277778
8  Moderate      S2  0.14492754          0.5362319   0.3188406
9      High      S2  0.08333333          0.5833333   0.3333333
10      Low      S3  0.17543860          0.5964912   0.2280702
11 Moderate      S3  0.33333333          0.3333333   0.3333333
12     High      S3  0.22222222          0.3888889   0.3888889
13      Low      S4  0.22222222          0.2222222   0.5555556
14 Moderate      S4  0.05555556          0.5555556   0.3888889
15     High      S4  0.33333333          0.3333333   0.3333333</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>Age[] <span class="ot">&lt;-</span> <span class="fu">normalize</span>(<span class="fu">as.CPF</span>(AgeTab<span class="sc">+</span><span class="dv">1</span><span class="sc">/</span><span class="fu">NodeNumStates</span>(Age)))</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>Age[]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    thalach  health Age.below50 Age.between50and60 Age.above60
1       Low Healthy  0.07843138          0.4313726   0.4901961
2  Moderate Healthy  0.25128207          0.4051282   0.3435898
3      High Healthy  0.56862748          0.3686275   0.0627451
4       Low      S1  0.23809524          0.5238096   0.2380952
5  Moderate      S1  0.26190478          0.4404762   0.2976190
6      High      S1  0.27083334          0.5208333   0.2083333
7       Low      S2  0.19444445          0.2777778   0.5277778
8  Moderate      S2  0.14492753          0.5362319   0.3188406
9      High      S2  0.08333334          0.5833333   0.3333333
10      Low      S3  0.17543860          0.5964912   0.2280702
11 Moderate      S3  0.33333334          0.3333333   0.3333333
12     High      S3  0.22222222          0.3888889   0.3888889
13      Low      S4  0.22222222          0.2222222   0.5555556
14 Moderate      S4  0.05555556          0.5555556   0.3888889
15     High      S4  0.33333334          0.3333333   0.3333333</code></pre>
</div>
</div>
<p>The <code>NodeProbs</code> function uses the array format.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">NodeProbs</span>(Age)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>, , Age = below50

          health
thalach       Healthy        S1         S2        S3         S4
  Low      0.07843138 0.2380952 0.19444445 0.1754386 0.22222222
  Moderate 0.25128207 0.2619048 0.14492753 0.3333333 0.05555556
  High     0.56862748 0.2708333 0.08333334 0.2222222 0.33333334

, , Age = between50and60

          health
thalach      Healthy        S1        S2        S3        S4
  Low      0.4313726 0.5238096 0.2777778 0.5964912 0.2222222
  Moderate 0.4051282 0.4404762 0.5362319 0.3333333 0.5555556
  High     0.3686275 0.5208333 0.5833333 0.3888889 0.3333333

, , Age = above60

          health
thalach      Healthy        S1        S2        S3        S4
  Low      0.4901961 0.2380952 0.5277778 0.2280702 0.5555556
  Moderate 0.3435898 0.2976190 0.3188406 0.3333333 0.3888889
  High     0.0627451 0.2083333 0.3333333 0.3888889 0.3333333

attr(,"class")
[1] "CPA"   "array"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (node <span class="cf">in</span> heart1.nodes) {</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  tab <span class="ot">&lt;-</span> <span class="fu">table</span>(cleveland[<span class="fu">c</span>(<span class="fu">ParentNames</span>(node),<span class="fu">NodeName</span>(node))])</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  node[] <span class="ot">&lt;-</span> <span class="fu">normalize</span>(<span class="fu">as.CPF</span>(tab<span class="sc">+</span><span class="dv">1</span><span class="sc">/</span><span class="fu">NodeNumStates</span>(node)))</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="the-healthy-node" class="level3">
<h3 class="anchored" data-anchor-id="the-healthy-node">The Healthy? node</h3>
<p>This is a deterministic node and requires special treatment.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>healthy <span class="ot">&lt;-</span> <span class="fu">NewDiscreteNode</span>(heart1,<span class="st">"healthy"</span>) <span class="co"># Default states are Yes, No</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="fu">NodeTitle</span>(healthy) <span class="ot">&lt;-</span> <span class="st">"Healthy?"</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="fu">NodeParents</span>(healthy) <span class="ot">&lt;-</span> <span class="fu">list</span>(heart1<span class="sc">$</span>nodes<span class="sc">$</span>health)</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="fu">NodeVisPos</span>(healthy) <span class="ot">&lt;-</span> heart.structure[[<span class="st">"healthy"</span>]]<span class="sc">$</span>pos</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>healthy[[<span class="st">"Healthy"</span>]] <span class="ot">&lt;-</span> <span class="st">"Yes"</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>healthy[[<span class="fu">c</span>(<span class="st">"S1"</span>,<span class="st">"S2"</span>,<span class="st">"S3"</span>,<span class="st">"S4"</span>)]] <span class="ot">&lt;-</span> <span class="st">"No"</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>healthy[[]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   health healthy
1 Healthy     Yes
2      S1      No
3      S2      No
4      S3      No
5      S4      No</code></pre>
</div>
</div>
<p>Compiling the network will give a warning if any node lacks a CPT.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">CompileNetwork</span>(heart1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Write it out.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>tmpfile <span class="ot">&lt;-</span> <span class="fu">tempfile</span>(<span class="st">"Heart"</span>,<span class="at">fileext=</span><span class="st">".dne"</span>)  <span class="do">## DNE is ascii representations; NETA is binary</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="fu">WriteNetworks</span>(heart1,tmpfile)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="working-with-case-files" class="level2">
<h2 class="anchored" data-anchor-id="working-with-case-files">Working with Case Files</h2>
<p>Netica supports <em>case files</em>, which are essentially CSV files. These are easier ways to manage large numbers of cases.</p>
<p>The function <code>CaseFileStream()</code> generates a new file stream. The functions <code>ReadFindings()</code> and <code>WriteFindings()</code> read and write to the case stream.</p>
<p>As we want the <code>CaseStream</code> to stay open while we are reading, explicitly call <code>OpenCaseStream</code> and <code>CloseCaseStream</code>.</p>
<p>Note that good programming style requires that the <code>CaseStream</code> be closed when you are done with it. To ensure this, use <code>WithOpenCaseStream(</code><em>stream</em>,<code>{...})</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>casefile <span class="ot">&lt;-</span> <span class="fu">tempfile</span>(<span class="at">fileext=</span><span class="st">".cas"</span>)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>filestream <span class="ot">&lt;-</span> <span class="fu">CaseFileStream</span>(casefile,<span class="at">session=</span>sess)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="fu">WithOpenCaseStream</span>(filestream, {</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Do some stuff</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Or equivalently use the withr::defer construct</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">OpenCaseStream</span>(filestream)</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>  withr<span class="sc">::</span><span class="fu">defer</span>(<span class="fu">CloseCaseStream</span>(filestream))</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that the <code>CaseStream</code> is opened in the Netica environment, not the R environment.</p>
<section id="generating-random-cases" class="level3">
<h3 class="anchored" data-anchor-id="generating-random-cases">Generating random cases</h3>
<p>Start by generating random cases.</p>
<p>Note that Netica uses a different random number sequence than R. To make a reproducible sequence, we need to create a <code>NeticaRNG</code> object and give it a seed. Use the <code>FreeNeticaRNG</code> method to free it when you are done (or use <code>WithNeticaRNG</code> to free it at the end of the computation.</p>
<p>You can also associate the RNG with a network using <code>NetworkSetRNG()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">CompileNetwork</span>(heart)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="fu">RetractNetFindings</span>(heart)</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>rnodes <span class="ot">&lt;-</span> <span class="fu">NetworkAllNodes</span>(heart)</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>casefile <span class="ot">&lt;-</span> <span class="fu">tempfile</span>(<span class="st">"heartrandom"</span>,<span class="at">fileext=</span><span class="st">".cas"</span>)</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>filestream <span class="ot">&lt;-</span> <span class="fu">CaseFileStream</span>(casefile,<span class="at">session=</span>sess)</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>rng <span class="ot">&lt;-</span> <span class="fu">NewNeticaRNG</span>(<span class="dv">12345</span>,<span class="at">session=</span>sess)</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> 10L</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a><span class="fu">WithRNG</span>(rng,</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">WithOpenCaseStream</span>(filestream,</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (n <span class="cf">in</span> 1L<span class="sc">:</span>N) {</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">GenerateRandomCase</span>(rnodes,<span class="at">rng=</span>rng)</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">WriteFindings</span>(rnodes,filestream,n)</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">RetractNetFindings</span>(heart)</span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>    }))</span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>ranCases <span class="ot">&lt;-</span> <span class="fu">read.CaseFile</span>(casefile,<span class="at">session=</span>sess)</span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>ranCases</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   IDnum  health             thal                    restecg    fbs    ca
1      1 Healthy           Normal                     Normal normal   One
2      2      S1 ReversibleDefect                     Normal normal  Four
3      3 Healthy           Normal LeftVentricularHypertrophy normal  Zero
4      4 Healthy      FixedDefect                     Normal normal Three
5      5 Healthy ReversibleDefect                     Normal normal  Zero
6      6 Healthy           Normal                     Normal normal  Zero
7      7      S1           Normal LeftVentricularHypertrophy normal  Zero
8      8 Healthy ReversibleDefect                     Normal normal   One
9      9 Healthy           Normal LeftVentricularHypertrophy normal  Zero
10    10 Healthy           Normal LeftVentricularHypertrophy normal  Zero
    thalach slope              CP healthy   oldpeak      Age    Sex    chol
1  336.8150  down    Asymptomatic     Yes  1.797370 83.09490   Male 336.272
2  447.8580  down    Asymptomatic      No  1.620750 24.84530   Male 375.803
3  167.0890    up      NonAnginal     Yes  2.078560  5.79728 Female 344.551
4   14.9075  down AtypicalAnginal     Yes  1.460710 74.15340   Male 346.944
5  273.5120  flat      NonAnginal     Yes  0.716837 29.03160   Male 423.564
6  385.7460  down      NonAnginal     Yes  1.785150 43.65560   Male 448.651
7  167.2420  down    Asymptomatic      No  2.658360 28.84410   Male 479.814
8  462.3440    up AtypicalAnginal     Yes -8.350040 30.89620   Male 485.311
9  485.7980  down      NonAnginal     Yes  1.343940 10.48630 Female 448.566
10 391.5800  flat      NonAnginal     Yes -6.699450  1.43075   Male 320.405
   exang trestbps
1    Yes 141.8620
2    Yes 136.2370
3    Yes 132.9230
4     No 129.0380
5     No 134.2890
6     No 135.1820
7     No 139.9000
8     No 122.9250
9     No  27.2462
10    No 122.2600</code></pre>
</div>
</div>
<p>The function <code>read.CaseFile</code> reads the generated cases and sets them up as a data frame.</p>
</section>
<section id="converting-data-into-case-file-format" class="level3">
<h3 class="anchored" data-anchor-id="converting-data-into-case-file-format">Converting data into case file format</h3>
<p>Note that continuous variables are left at their numeric values. Need to reread cleveland data and not do the conversion this time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>cleveland1 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Heart/processed.cleveland.csv"</span>,</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">col_names=</span><span class="fu">names</span>(heart.features),</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">col_types=</span><span class="fu">str_pad</span>(<span class="st">""</span>,</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">width=</span><span class="fu">length</span>(heart.features),</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">pad=</span><span class="st">"n"</span>),</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">na=</span><span class="st">"?"</span>)</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (var <span class="cf">in</span> <span class="fu">names</span>(heart.features)) {</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>  states <span class="ot">&lt;-</span> heart.features[[var]]</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">names</span>(states)[<span class="dv">1</span>]<span class="sc">==</span><span class="st">""</span>) {</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Continuous node, leave as is create variable.</span></span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Discrete node, use factor.</span></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>    cleveland1[[var]] <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">as.integer</span>(cleveland1[[var]]),</span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>               <span class="at">levels=</span><span class="fu">as.integer</span>(states),<span class="at">labels=</span><span class="fu">names</span>(states))</span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a><span class="fu">write.CaseFile</span>(cleveland1,<span class="st">"Heart/cleveland.cas"</span>,<span class="at">session=</span>sess)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>While we are at it, lets convert the Swiss and Hungarian data to case files.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>swiss <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Heart/processed.switzerland.csv"</span>,</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">col_names=</span><span class="fu">names</span>(heart.features),</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">col_types=</span><span class="fu">str_pad</span>(<span class="st">""</span>,</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">width=</span><span class="fu">length</span>(heart.features),</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">pad=</span><span class="st">"n"</span>),</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">na=</span><span class="st">"?"</span>)</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>hungary <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Heart/processed.hungarian.csv"</span>,</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">col_names=</span><span class="fu">names</span>(heart.features),</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">col_types=</span><span class="fu">str_pad</span>(<span class="st">""</span>,</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">width=</span><span class="fu">length</span>(heart.features),</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">pad=</span><span class="st">"n"</span>),</span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>                      <span class="at">na=</span><span class="st">"?"</span>)</span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (var <span class="cf">in</span> <span class="fu">names</span>(heart.features)) {</span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>  states <span class="ot">&lt;-</span> heart.features[[var]]</span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">names</span>(states)[<span class="dv">1</span>]<span class="sc">==</span><span class="st">""</span>) {</span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Continuous node, leave as is create variable.</span></span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Discrete node, use factor.</span></span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a>    swiss[[var]] <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">as.integer</span>(swiss[[var]]),</span>
<span id="cb75-20"><a href="#cb75-20" aria-hidden="true" tabindex="-1"></a>               <span class="at">levels=</span><span class="fu">as.integer</span>(states),<span class="at">labels=</span><span class="fu">names</span>(states))</span>
<span id="cb75-21"><a href="#cb75-21" aria-hidden="true" tabindex="-1"></a>    hungary[[var]] <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">as.integer</span>(hungary[[var]]),</span>
<span id="cb75-22"><a href="#cb75-22" aria-hidden="true" tabindex="-1"></a>               <span class="at">levels=</span><span class="fu">as.integer</span>(states),<span class="at">labels=</span><span class="fu">names</span>(states))</span>
<span id="cb75-23"><a href="#cb75-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb75-24"><a href="#cb75-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb75-25"><a href="#cb75-25" aria-hidden="true" tabindex="-1"></a><span class="fu">write.CaseFile</span>(swiss,<span class="st">"Heart/switzerland.cas"</span>,<span class="at">session=</span>sess)</span>
<span id="cb75-26"><a href="#cb75-26" aria-hidden="true" tabindex="-1"></a><span class="fu">write.CaseFile</span>(hungary,<span class="st">"Heart/hungary.cas"</span>,<span class="at">session=</span>sess)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="bulk-scoring-and-testing" class="level3">
<h3 class="anchored" data-anchor-id="bulk-scoring-and-testing">Bulk Scoring and Testing</h3>
<p>Bulk Scoring can be done by looping through the case file.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>swissStream <span class="ot">&lt;-</span> <span class="fu">CaseFileStream</span>(<span class="st">"Heart/switzerland.cas"</span>,sess)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>testnodes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">NetworkNodesInSet</span>(heart,<span class="st">"office"</span>),</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>               <span class="fu">NetworkNodesInSet</span>(heart,<span class="st">"lab"</span>))</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="fu">WithOpenCaseStream</span>(swissStream, {</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> 1L<span class="sc">:</span>10L) {</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">RetractNetFindings</span>(heart)</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>    swissStream <span class="ot">&lt;-</span> </span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ReadFindings</span>(testnodes,</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>                  swissStream,</span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">ifelse</span>(i<span class="sc">==</span>1L,<span class="st">"FIRST"</span>,<span class="st">"NEXT"</span>))</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Case "</span>, i,<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">NodeBeliefs</span>(health),<span class="at">digits=</span><span class="dv">3</span>)</span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.na</span>(<span class="fu">getCaseStreamPos</span>(swissStream))) <span class="cf">break</span></span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Case  1 
Healthy      S1      S2      S3      S4 
 0.6670  0.1447  0.0245  0.0319  0.1319 
Case  2 
Healthy      S1      S2      S3      S4 
 0.3438  0.1901  0.0833  0.2095  0.1733 
Case  3 
Healthy      S1      S2      S3      S4 
 0.3438  0.1901  0.0833  0.2095  0.1733 
Case  4 
Healthy      S1      S2      S3      S4 
 0.3438  0.1901  0.0833  0.2095  0.1733 
Case  5 
Healthy      S1      S2      S3      S4 
 0.5600  0.1681  0.0502  0.1226  0.0992 
Case  6 
Healthy      S1      S2      S3      S4 
 0.5648  0.1808  0.0436  0.1094  0.1014 
Case  7 
Healthy      S1      S2      S3      S4 
 0.8201  0.0730  0.0186  0.0483  0.0400 
Case  8 
Healthy      S1      S2      S3      S4 
 0.8224  0.0781  0.0161  0.0428  0.0406 
Case  9 
Healthy      S1      S2      S3      S4 
 0.3438  0.1901  0.0833  0.2095  0.1733 
Case  10 
Healthy      S1      S2      S3      S4 
 0.3438  0.1901  0.0833  0.2095  0.1733 </code></pre>
</div>
</div>
<p>Obviously, what we want to do is compare this to the actual readings. The <code>NetworkTester</code> allows us to do that.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">RetractNetFindings</span>(heart)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>swiss.test <span class="ot">&lt;-</span> </span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">testNetwork</span>(<span class="fu">list</span>(health),</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>              <span class="fu">OpenCaseStream</span>(swissStream))</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(swiss.test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       ErrorRate  LogLoss QuadraticLoss       kappa         QWK lambda
health 0.8292683 1.827684      0.912821 -0.06385144 -0.03701352  -0.36
       LinearLambda
health   -0.3445783</code></pre>
</div>
</div>
</section>
<section id="learning-cpts" class="level3">
<h3 class="anchored" data-anchor-id="learning-cpts">Learning CPTs</h3>
<p>With a case stream we can learn all of the CPTs at once.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>lnodes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">NetworkNodesInSet</span>(heart1,<span class="st">"office"</span>),</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>            <span class="fu">NetworkNodesInSet</span>(heart1,<span class="st">"lab"</span>))</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">sapply</span>(lnodes,DeleteNodeTable))</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="fu">LearnCases</span>(<span class="st">"Heart/cleveland.cas"</span>,lnodes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Look at the new values.</p>
<p>Node experience is how many responses were used in that row of the table.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>heart1<span class="sc">$</span>nodes<span class="sc">$</span>trestbps[]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             Age trestbps.low trestbps.moderate trestbps.high
1        below50    0.3222222         0.5444444     0.1333333
2 between50and60    0.1640625         0.5000000     0.3359375
3        above60    0.1382979         0.3723404     0.4893617</code></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">NodeExperience</span>(heart1<span class="sc">$</span>nodes<span class="sc">$</span>trestbps)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Age
       below50 between50and60        above60 
            90            128             94 </code></pre>
</div>
</div>
<p>LearnCases uses the same counting algorithm shown above (building the CPT), so it doesn’t handle missing data.</p>
<p>LearnCPTs does. There are three methods. I recommend EM</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">sapply</span>(lnodes,DeleteNodeTable))</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="fu">LearnCPTs</span>(<span class="st">"Heart/cleveland.cas"</span>,lnodes, <span class="at">method=</span><span class="st">"EM"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>NULL</code></pre>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>heart1<span class="sc">$</span>nodes<span class="sc">$</span>trestbps[]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             Age trestbps.low trestbps.moderate trestbps.high
1        below50    0.3218391         0.5517241     0.1264368
2 between50and60    0.1600000         0.5039999     0.3360000
3        above60    0.1318682         0.3736264     0.4945054</code></pre>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">NodeExperience</span>(heart1<span class="sc">$</span>nodes<span class="sc">$</span>trestbps)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Age
       below50 between50and60        above60 
      87.00003      125.00003       91.00003 </code></pre>
</div>
</div>
</section>
</section>
<section id="learning-structure-from-data" class="level2">
<h2 class="anchored" data-anchor-id="learning-structure-from-data">Learning Structure from Data</h2>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Fixing the HeartNet to properly use continuous nodes.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>(This was some code I used to fix and issue with the initial version of the test network which had the continuous nodes coded as discrete.)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>heart.info <span class="ot">&lt;-</span> <span class="fu">lapply</span>(heart.nodes, <span class="cf">function</span> (nd) {</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">parents =</span> <span class="fu">ParentNames</span>(nd),</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">cpt =</span> <span class="fu">NodeProbs</span>(nd),</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">pos=</span> <span class="fu">NodeVisPos</span>(nd),</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">title=</span><span class="fu">NodeTitle</span>(nd))</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Number of states of Age has changed, need to fix some CPTs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>fixme <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Age"</span>,<span class="st">"trestbps"</span>)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (nodename <span class="cf">in</span> fixme) {</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>  xtab <span class="ot">&lt;-</span> <span class="fu">as.array</span>(<span class="fu">table</span>(cleveland[<span class="fu">c</span>(heart.info[[nodename]]<span class="sc">$</span>parents,nodename)]))</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(xtab) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"CPA"</span>,<span class="st">"array"</span>)</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>  probs <span class="ot">&lt;-</span> <span class="fu">normalize</span>(xtab<span class="sc">+</span><span class="dv">1</span><span class="sc">/</span><span class="fu">last</span>(<span class="fu">dim</span>(xtab)))</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>  heart.info[[nodename]]<span class="sc">$</span>cpt <span class="ot">&lt;-</span> probs</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ( nodename <span class="cf">in</span> <span class="fu">names</span>(heart.features)) {</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>  states <span class="ot">&lt;-</span> heart.features[[nodename]]</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">all</span>(<span class="fu">names</span>(states)<span class="sc">!=</span><span class="st">""</span>)) <span class="cf">next</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>  oldnode <span class="ot">&lt;-</span> heart.nodes[[nodename]]</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Save old data</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>  title <span class="ot">&lt;-</span> <span class="fu">NodeTitle</span>(oldnode)</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>  descrip <span class="ot">&lt;-</span> <span class="fu">NodeDescription</span>(oldnode)</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>  vispos <span class="ot">&lt;-</span> <span class="fu">NodeVisPos</span>(oldnode)</span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Replace node</span></span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">DeleteNodes</span>(oldnode)</span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>  newnode <span class="ot">&lt;-</span> <span class="fu">NewContinuousNode</span>(heart,nodename)</span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Fix properties</span></span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">NodeTitle</span>(newnode) <span class="ot">&lt;-</span> title</span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">NodeDescription</span>(newnode) <span class="ot">&lt;-</span> descrip</span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">NodeVisPos</span>(newnode) <span class="ot">&lt;-</span> vispos</span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Fix the states</span></span>
<span id="cb93-17"><a href="#cb93-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">NodeLevels</span>(newnode) <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(states)</span>
<span id="cb93-18"><a href="#cb93-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">NodeStates</span>(newnode) <span class="ot">&lt;-</span> <span class="fu">names</span>(states)[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb93-19"><a href="#cb93-19" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Fix the list of nodes.</span></span>
<span id="cb93-20"><a href="#cb93-20" aria-hidden="true" tabindex="-1"></a>  heart.nodes[[nodename]] <span class="ot">&lt;-</span> newnode</span>
<span id="cb93-21"><a href="#cb93-21" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Fix up any set of broken parent relationships.</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (nodename <span class="cf">in</span> <span class="fu">names</span>(heart.info)) {</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(nodename,<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>  node <span class="ot">&lt;-</span> heart.nodes[[nodename]]</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>  parents <span class="ot">&lt;-</span> heart.nodes[heart.info[[nodename]]<span class="sc">$</span>parents]</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">NodeParents</span>(node) <span class="ot">&lt;-</span> parents</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">NodeProbs</span>(node) <span class="ot">&lt;-</span> heart.info[[nodename]]<span class="sc">$</span>cpt</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">CompileNetwork</span>(heart)</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="fu">WriteNetworks</span>(heart,<span class="st">"Heart/Heart.dne"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">NodeStates</span>(heart<span class="sc">$</span>nodes<span class="sc">$</span>CP)[<span class="dv">4</span>] <span class="ot">&lt;-</span> <span class="st">"Asymptomatic"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-line-spacing="2" role="list">
<div id="ref-good1950" class="csl-entry" role="listitem">
Good, I. J. (1950). <em>Probability and the <span>Weighing</span> of <span>Evidence</span></em>. <span>Charles Griffin</span>.
</div>
<div id="ref-goodCard1971" class="csl-entry" role="listitem">
Good, I. J., &amp; Card, W. (1971). The diagnostic process with special reference to errors. <em>Methods of Information in Medicine</em>, <em>10</em>, 176–188.
</div>
<div id="ref-testSelection" class="csl-entry" role="listitem">
Madigan, D., &amp; Almond, R. G. (1995). Test selection strategies for belief networks. In D. Fisher &amp; H. J. Lenz (Eds.), <em>Learning from <span>Data</span>: <span>AI</span> and <span>Statistics V</span></em> (pp. 89–98). <span>Springer-Verlag</span>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>